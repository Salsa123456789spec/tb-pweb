<div class="p-8 bg-gray-50 min-h-screen">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">Penjadwalan Wawancara</h1>

        <!-- Form Tambah Jadwal -->
        <div class="bg-white p-8 rounded-xl shadow-lg mb-10">
            <h3 class="text-xl font-semibold mb-6 text-gray-700">Buat Jadwal Baru</h3>
            <form action="/aslab/jadwal-wawancara" method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <div>
                    <label for="pendaftaran_id" class="block text-sm font-medium text-gray-700 mb-2">Peserta</label>
                    <select id="pendaftaran_id" name="pendaftaran_id" required class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 p-3 transition duration-150 ease-in-out">
                        <option value="" disabled selected>Pilih peserta yang lolos</option>
                        <% pendaftar.forEach(p => { %>
                            <option value="<%= p.id %>"><%= p.user.name %> (<%= p.user.nim %>)</option>
                        <% }); %>
                    </select>
                </div>

                <div>
                    <label for="pewawancara_id" class="block text-sm font-medium text-gray-700 mb-2">Pewawancara</label>
                    <select id="pewawancara_id" name="pewawancara_id" required class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 p-3 transition duration-150 ease-in-out">
                        <option value="" disabled selected>Pilih pewawancara</option>
                        <% pewawancara.forEach(p => { %>
                            <option value="<%= p.id %>"><%= p.nama %></option>
                        <% }); %>
                    </select>
                </div>

                <div>
                    <label for="tanggal" class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                    <input type="date" id="tanggal" name="tanggal" required class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 p-3 transition duration-150 ease-in-out">
                </div>

                <div>
                    <label for="waktu" class="block text-sm font-medium text-gray-700 mb-2">Waktu</label>
                    <input type="time" id="waktu" name="waktu" required class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 p-3 transition duration-150 ease-in-out">
                </div>
                
                <div class="md:col-span-2">
                    <label for="ruang" class="block text-sm font-medium text-gray-700 mb-2">Ruang / Tautan</label>
                    <input type="text" id="ruang" name="ruang" placeholder="Contoh: Ruang Rapat FTI atau Link Google Meet" required class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 p-3 transition duration-150 ease-in-out">
                </div>

                <div class="md:col-span-2 text-right">
                    <button type="submit" class="inline-flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition duration-300 ease-in-out transform hover:-translate-y-1">
                        <i class="fas fa-plus mr-2"></i>
                        Buat Jadwal
                    </button>
                </div>
            </form>
        </div>

        <!-- Daftar Jadwal Terkini -->
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Jadwal Terkini</h2>
        <div class="bg-white shadow-xl rounded-xl overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full w-full">
                    <thead>
                        <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                            <th class="py-4 px-6 text-left">No</th>
                            <th class="py-4 px-6 text-left">Nama Peserta</th>
                            <th class="py-4 px-6 text-left">Pewawancara</th>
                            <th class="py-4 px-6 text-center">Tanggal & Waktu</th>
                            <th class="py-4 px-6 text-left">Ruang</th>
                            <th class="py-4 px-6 text-center">Aksi</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-700 text-sm">
                        <% jadwalTerkini.forEach((jadwal, index) => { %>
                            <tr class="border-b border-gray-200 hover:bg-gray-100 transition duration-150 ease-in-out">
                                <td class="py-4 px-6 text-left whitespace-nowrap"><%= index + 1 %></td>
                                <td class="py-4 px-6 text-left font-medium text-gray-800"><%= jadwal.pendaftaran.user.name %></td>
                                <td class="py-4 px-6 text-left"><%= jadwal.pewawancara ? jadwal.pewawancara.nama : 'N/A' %></td>
                                <td class="py-4 px-6 text-center">
                                    <span class="font-medium"><%= new Date(jadwal.tanggal).toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' }) %></span>
                                    <span class="block text-xs text-gray-500"><%= new Date(jadwal.waktu).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', hour12: false }) %> WIB</span>
                                </td>
                                <td class="py-4 px-6 text-left"><%= jadwal.ruang %></td>
                                <td class="py-4 px-6 text-center">
                                    <div class="flex item-center justify-center">
                                        <a href="/aslab/jadwal-wawancara/edit/<%= jadwal.id %>" class="w-8 h-8 flex items-center justify-center rounded-full bg-yellow-500 text-white hover:bg-yellow-600 mr-2 transform hover:scale-110 transition-transform">
                                            <i class="fas fa-pencil-alt"></i>
                                        </a>
                                        <button data-id="<%= jadwal.id %>" class="delete-jadwal-btn w-8 h-8 flex items-center justify-center rounded-full bg-red-500 text-white hover:bg-red-600 transform hover:scale-110 transition-transform">
                                            <i class="fas fa-trash-alt"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        <% }); %>
                         <% if (jadwalTerkini.length === 0) { %>
                            <tr>
                                <td colspan="6" class="text-center py-6 text-gray-500">Belum ada jadwal yang dibuat.</td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const deleteButtons = document.querySelectorAll('.delete-jadwal-btn');
    deleteButtons.forEach(button => {
        button.addEventListener('click', function() {
            const jadwalId = this.dataset.id;
            Swal.fire({
                title: 'Anda yakin?',
                text: "Jadwal ini akan dihapus secara permanen!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Ya, hapus!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/aslab/jadwal-wawancara/delete/${jadwalId}`, {
                        method: 'DELETE',
                    }).then(res => {
                        if (res.ok) {
                            Swal.fire(
                                'Dihapus!',
                                'Jadwal telah berhasil dihapus.',
                                'success'
                            ).then(() => {
                                window.location.reload();
                            });
                        } else {
                            Swal.fire(
                                'Gagal!',
                                'Terjadi kesalahan saat menghapus jadwal.',
                                'error'
                            );
                        }
                    });
                }
            });
        });
    });
});
</script> 